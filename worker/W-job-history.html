<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hirewale · Job History</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --brand-600:#0ea5e9;
      --brand-700:#0284c7;
      --brand-success:#16a34a;
      --brand-warning:#f59e0b;
      --brand-danger:#dc2626;
      --ink:#0f172a;
      --card-bg:#ffffff;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(0, 0, 0, 0.08);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --transition-speed: 0.3s;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto;}
    body{
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 10% 10%, #e0f2fe 0%, transparent 60%),
        radial-gradient(1000px 500px at 90% 20%, #bae6fd 0%, transparent 60%),
        linear-gradient(180deg, #f0f9ff 0%, #ffffff 40%, #f8fafc 100%);
      color:var(--ink);
      display:flex;
      justify-content:center;
      padding:32px 0;
    }
    .dashboard{
      width:min(100%,1200px);
      display:grid;
      gap:24px;
      padding:0 16px;
      grid-template-areas: 
        "header"
        "stats"
        "filters"
        "history";
    }
    
    .header {
      grid-area: header;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    h1 {
      font-size: 28px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .stats {
      grid-area: stats;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      padding: 20px;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      border-left: 4px solid var(--brand-600);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(14, 165, 233, 0.2);
    }
    
    .stat-card .icon {
      font-size: 28px;
      color: var(--brand-600);
    }
    
    .stat-card .value {
      font-size: 24px;
      font-weight: 700;
      color: var(--ink);
    }
    
    .stat-card .label {
      font-size: 14px;
      color: #64748b;
    }
    
    .stat-card.earnings {
      border-left-color: var(--brand-success);
    }
    
    .stat-card.earnings .icon {
      color: var(--brand-success);
    }
    
    .stat-card.completed {
      border-left-color: var(--brand-warning);
    }
    
    .stat-card.completed .icon {
      color: var(--brand-warning);
    }
    
    .filters {
      grid-area: filters;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .filter-group label {
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
    }
    
    .filter-select, .search-input {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: white;
      font-size: 14px;
      min-width: 180px;
      transition: all 0.3s ease;
    }
    
    .filter-select:focus, .search-input:focus {
      outline: none;
      border-color: var(--brand-600);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
    }
    
    .search-input {
      padding-left: 40px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 16px center;
    }
    
    .history-container {
      grid-area: history;
      display: grid;
      gap: 20px;
    }
    
    .card{
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      border-radius:20px;
      padding:24px;
      box-shadow: var(--glass-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    
    .job-card{
      background: white;
      border: 1px solid #e2e8f0;
      border-radius:16px;
      padding:24px;
      box-shadow:0 4px 12px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 16px;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .job-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    
    .job-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    
    .job-title{
      font-weight:700;
      font-size:18px;
      color: var(--ink);
      margin: 0;
    }
    
    .job-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-accepted {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-done {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-cancelled {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .job-details{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      font-size:14px;
      color:#64748b;
    }
    
    .job-detail {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .job-detail i {
      width: 20px;
      color: var(--brand-600);
    }
    
    .job-description {
      color: #334155;
      line-height: 1.5;
      margin: 8px 0;
    }
    
    .job-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .job-tag {
      background: #f1f5f9;
      color: #475569;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .job-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    
    .job-date {
      font-size: 13px;
      color: #94a3b8;
    }
    
    .actions{
      display:flex;
      gap:12px;
    }
    
    .btn{
      padding:12px 20px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      transition: all 0.3s ease;
      color:white;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(0,0,0,0.15);
    }
    
    .done{
      background:var(--brand-success);
    }
    
    .done:hover{
      background:#15803d;
      box-shadow:0 6px 16px rgba(22, 163, 74, 0.4);
    }
    
    .back-btn{
      background:var(--brand-600);
      padding: 12px 24px;
    }
    
    .back-btn:hover{
      background:var(--brand-700);
      box-shadow:0 6px 16px rgba(14, 165, 233, 0.4);
    }
    
    .no-jobs {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }
    
    .no-jobs i {
      font-size: 48px;
      margin-bottom: 16px;
      color: #cbd5e1;
    }
    
    .no-jobs p {
      margin: 0;
      font-size: 18px;
    }
    
    /* Modal */
    .modal-overlay{
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      justify-content:center;
      align-items:center;
      z-index:1000;
      backdrop-filter: blur(4px);
    }
    
    .modal-content{
      background:var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px);
      padding:32px;
      border-radius:20px;
      max-width:500px;
      text-align:center;
      animation:bounceIn 0.45s ease;
      box-shadow: var(--glass-shadow);
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.8); }
      60% { opacity: 1; transform: scale(1.05); }
      80% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    
    .modal-header {
      margin-bottom: 20px;
    }
    
    .modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--brand-success);
    }
    
    .modal-title {
      font-size: 24px;
      margin: 0 0 8px 0;
    }
    
    .modal-message {
      color: #64748b;
      margin-bottom: 24px;
      line-height: 1.5;
    }
    
    .modal-job-details {
      background: #f8fafc;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      text-align: left;
    }
    
    .modal-job-detail {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .modal-job-detail:last-child {
      margin-bottom: 0;
    }
    
    .modal-job-detail .label {
      color: #64748b;
    }
    
    .modal-job-detail .value {
      font-weight: 600;
    }
    
    .modal-actions{
      display:flex;
      justify-content:center;
      gap:12px;
    }
    
    .modal-btn{
      padding:12px 24px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .modal-btn.confirm{
      background:var(--brand-success);
      color:white;
    }
    
    .modal-btn.confirm:hover {
      background:#15803d;
      transform: translateY(-2px);
      box-shadow:0 6px 16px rgba(22, 163, 74, 0.4);
    }
    
    .modal-btn.cancel{
      background:var(--brand-600);
      color:white;
    }
    
    .modal-btn.cancel:hover {
      background:var(--brand-700);
      transform: translateY(-2px);
      box-shadow:0 6px 16px rgba(14, 165, 233, 0.4);
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 24px;
    }
    
    .pagination-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .pagination-btn:hover {
      border-color: var(--brand-600);
      color: var(--brand-600);
    }
    
    .pagination-btn.active {
      background: var(--brand-600);
      color: white;
      border-color: var(--brand-600);
    }
    
    /* Timeline for completed jobs */
    .timeline {
      position: relative;
      margin: 20px 0;
      padding-left: 30px;
    }
    
    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #e2e8f0;
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 20px;
    }
    
    .timeline-item:last-child {
      margin-bottom: 0;
    }
    
    .timeline-dot {
      position: absolute;
      left: -30px;
      top: 5px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--brand-600);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
    }
    
    .timeline-content {
      background: #f8fafc;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
    }
    
    .timeline-date {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
    }
    
    /* Rating system */
    .rating {
      display: flex;
      gap: 4px;
      margin-top: 8px;
    }
    
    .rating-star {
      color: #cbd5e1;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .rating-star.active {
      color: #f59e0b;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .filters {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .filter-group {
        width: 100%;
      }
      
      .filter-select, .search-input {
        width: 100%;
      }
      
      .job-card-header {
        flex-direction: column;
        gap: 12px;
      }
      
      .job-card-footer {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }
      
      .actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .btn {
        flex: 1;
      }
      
      .stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1><i class="fas fa-history"></i> Job History</h1>
      <button class="btn back-btn" onclick="window.location.href='W-dashboard.html'">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </button>
    </div>

    <div class="stats">
      <div class="stat-card earnings">
        <div class="icon"><i class="fas fa-wallet"></i></div>
        <div class="value">₹<span id="totalEarnings">0</span></div>
        <div class="label">Total Earnings</div>
      </div>
      <div class="stat-card completed">
        <div class="icon"><i class="fas fa-check-circle"></i></div>
        <div class="value" id="completedJobs">0</div>
        <div class="label">Completed Jobs</div>
      </div>
      <div class="stat-card">
        <div class="icon"><i class="fas fa-clock"></i></div>
        <div class="value" id="activeJobs">0</div>
        <div class="label">Active Jobs</div>
      </div>
      <div class="stat-card">
        <div class="icon"><i class="fas fa-star"></i></div>
        <div class="value" id="avgRating">0.0</div>
        <div class="label">Average Rating</div>
      </div>
    </div>

    <div class="card filters">
      <div class="filter-group">
        <label for="statusFilter">Status</label>
        <select id="statusFilter" class="filter-select">
          <option value="all">All Jobs</option>
          <option value="accepted">Active Jobs</option>
          <option value="done">Completed Jobs</option>
          <option value="cancelled">Cancelled Jobs</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="sortBy">Sort By</label>
        <select id="sortBy" class="filter-select">
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
          <option value="price-high">Price: High to Low</option>
          <option value="price-low">Price: Low to High</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="searchInput">Search</label>
        <input type="text" id="searchInput" class="search-input" placeholder="Search jobs...">
      </div>
    </div>

    <div class="history-container" id="jobsContainer">
      <!-- Job cards will be populated by JavaScript -->
    </div>

    <div class="pagination" id="pagination">
      <!-- Pagination will be populated by JavaScript -->
    </div>
  </div>

  <!-- Mark as Done Modal -->
  <div id="doneModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3 class="modal-title">Mark Job as Complete</h3>
        <p class="modal-message" id="modalMessage">Are you sure you want to mark this job as complete?</p>
      </div>
      
      <div class="modal-job-details" id="modalJobDetails">
        <!-- Job details will be populated by JavaScript -->
      </div>
      
      <div class="modal-actions">
        <button id="confirmDone" class="modal-btn confirm">
          <i class="fas fa-check"></i> Mark Complete
        </button>
        <button id="cancelDone" class="modal-btn cancel">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Job Details Modal -->
  <div id="detailModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 600px; text-align: left;">
      <div class="modal-header" style="text-align: center;">
        <h3 class="modal-title" id="detailTitle">Job Details</h3>
      </div>
      
      <div id="detailContent">
        <!-- Job details will be populated by JavaScript -->
      </div>
      
      <div class="modal-actions">
        <button id="closeDetail" class="modal-btn cancel">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </div>
  </div>

  <!-- Rating Modal -->
  <div id="ratingModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-icon">
          <i class="fas fa-star"></i>
        </div>
        <h3 class="modal-title">Rate Your Experience</h3>
        <p class="modal-message">How would you rate your experience with this job?</p>
      </div>
      
      <div class="modal-job-details" id="ratingJobDetails">
        <!-- Job details will be populated by JavaScript -->
      </div>
      
      <div style="margin: 20px 0; text-align: center;">
        <div class="rating" id="ratingStars">
          <i class="fas fa-star rating-star" data-rating="1"></i>
          <i class="fas fa-star rating-star" data-rating="2"></i>
          <i class="fas fa-star rating-star" data-rating="3"></i>
          <i class="fas fa-star rating-star" data-rating="4"></i>
          <i class="fas fa-star rating-star" data-rating="5"></i>
        </div>
        <p id="ratingText" style="margin-top: 8px; color: #64748b; font-size: 14px;">Tap a star to rate</p>
      </div>
      
      <div class="modal-actions">
        <button id="submitRating" class="modal-btn confirm" disabled>
          <i class="fas fa-check"></i> Submit Rating
        </button>
        <button id="cancelRating" class="modal-btn cancel">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <script>
    // Enhanced Job History functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Load jobs from sessionStorage or create defaults
      let jobs = JSON.parse(sessionStorage.getItem("jobs")) || [
        {
          id: 1, 
          title: "Fix kitchen wiring", 
          location: "Mangalore", 
          pay: 500, 
          status: "done",
          category: "electrical",
          description: "Fixed kitchen wiring that was causing frequent short circuits.",
          client: "Rahul Sharma",
          posted: "2023-06-10T14:30:00",
          completed: "2023-06-11T16:45:00",
          duration: "2 hours",
          rating: 4,
          timeline: [
            { action: "Accepted", date: "2023-06-10T15:00:00" },
            { action: "Started", date: "2023-06-11T14:30:00" },
            { action: "Completed", date: "2023-06-11T16:45:00" }
          ]
        },
        {
          id: 2, 
          title: "Install ceiling fan", 
          location: "Udupi", 
          pay: 400, 
          status: "accepted",
          category: "electrical",
          description: "Need to install a new ceiling fan in living room. Existing wiring is in place.",
          client: "Priya Patel",
          posted: "2023-06-12T09:15:00",
          timeline: [
            { action: "Accepted", date: "2023-06-12T10:30:00" }
          ]
        },
        {
          id: 3, 
          title: "Repair water heater", 
          location: "Mangalore", 
          pay: 600, 
          status: "done",
          category: "plumbing",
          description: "Repaired water heater that wasn't heating properly.",
          client: "Vikram Malhotra",
          posted: "2023-06-13T16:45:00",
          completed: "2023-06-14T12:30:00",
          duration: "3 hours",
          rating: 5,
          timeline: [
            { action: "Accepted", date: "2023-06-13T17:20:00" },
            { action: "Started", date: "2023-06-14T09:30:00" },
            { action: "Completed", date: "2023-06-14T12:30:00" }
          ]
        },
        {
          id: 4, 
          title: "Fix leaking pipe", 
          location: "Bangalore", 
          pay: 350, 
          status: "cancelled",
          category: "plumbing",
          description: "Kitchen sink pipe was leaking and needed to be fixed or replaced.",
          client: "Ananya Reddy",
          posted: "2023-06-14T11:20:00",
          cancelled: "2023-06-15T09:45:00",
          timeline: [
            { action: "Accepted", date: "2023-06-14T12:05:00" },
            { action: "Cancelled", date: "2023-06-15T09:45:00" }
          ]
        }
      ];
      sessionStorage.setItem("jobs", JSON.stringify(jobs));
      
      // DOM Elements
      const jobsContainer = document.getElementById("jobsContainer");
      const doneModal = document.getElementById("doneModal");
      const detailModal = document.getElementById("detailModal");
      const ratingModal = document.getElementById("ratingModal");
      const statusFilter = document.getElementById("statusFilter");
      const sortBy = document.getElementById("sortBy");
      const searchInput = document.getElementById("searchInput");
      const paginationContainer = document.getElementById("pagination");
      
      // Stats elements
      const totalEarnings = document.getElementById("totalEarnings");
      const completedJobs = document.getElementById("completedJobs");
      const activeJobs = document.getElementById("activeJobs");
      const avgRating = document.getElementById("avgRating");
      
      // State variables
      let selectedJob = null;
      let currentPage = 1;
      const jobsPerPage = 5;
      let filteredJobs = [];
      let currentRating = 0;
      
      // Initialize the page
      function init() {
        filteredJobs = [...jobs.filter(job => job.status !== "pending")];
        updateStats();
        applyFilters();
        setupEventListeners();
      }
      
      // Update statistics
      function updateStats() {
        const completed = jobs.filter(job => job.status === "done").length;
        const active = jobs.filter(job => job.status === "accepted").length;
        const earnings = jobs
          .filter(job => job.status === "done")
          .reduce((sum, job) => sum + job.pay, 0);
        
        const ratings = jobs
          .filter(job => job.rating)
          .map(job => job.rating);
        
        const averageRating = ratings.length > 0 
          ? (ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length).toFixed(1)
          : "0.0";
        
        totalEarnings.textContent = earnings.toLocaleString('en-IN');
        completedJobs.textContent = completed;
        activeJobs.textContent = active;
        avgRating.textContent = averageRating;
      }
      
      // Set up event listeners
      function setupEventListeners() {
        // Filter event listeners
        statusFilter.addEventListener('change', applyFilters);
        sortBy.addEventListener('change', applyFilters);
        searchInput.addEventListener('input', applyFilters);
        
        // Modal event listeners
        document.getElementById('cancelDone').addEventListener('click', closeDoneModal);
        document.getElementById('confirmDone').addEventListener('click', confirmDone);
        document.getElementById('closeDetail').addEventListener('click', closeDetailModal);
        document.getElementById('cancelRating').addEventListener('click', closeRatingModal);
        document.getElementById('submitRating').addEventListener('click', submitRating);
        
        // Rating stars
        document.querySelectorAll('.rating-star').forEach(star => {
          star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            setRating(rating);
          });
          
          star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            highlightStars(rating);
          });
          
          star.addEventListener('mouseleave', function() {
            highlightStars(currentRating);
          });
        });
      }
      
      // Apply all filters and render jobs
      function applyFilters() {
        const status = statusFilter.value;
        const sort = sortBy.value;
        const searchTerm = searchInput.value.toLowerCase();
        
        // Filter jobs
        filteredJobs = jobs.filter(job => {
          if (job.status === "pending") return false;
          if (status !== "all" && job.status !== status) return false;
          if (searchTerm && !(
            job.title.toLowerCase().includes(searchTerm) ||
            job.description.toLowerCase().includes(searchTerm) ||
            job.client.toLowerCase().includes(searchTerm)
          )) return false;
          
          return true;
        });
        
        // Sort jobs
        switch(sort) {
          case 'newest':
            filteredJobs.sort((a, b) => {
              const dateA = a.completed || a.posted;
              const dateB = b.completed || b.posted;
              return new Date(dateB) - new Date(dateA);
            });
            break;
          case 'oldest':
            filteredJobs.sort((a, b) => {
              const dateA = a.completed || a.posted;
              const dateB = b.completed || b.posted;
              return new Date(dateA) - new Date(dateB);
            });
            break;
          case 'price-high':
            filteredJobs.sort((a, b) => b.pay - a.pay);
            break;
          case 'price-low':
            filteredJobs.sort((a, b) => a.pay - b.pay);
            break;
        }
        
        // Reset to first page
        currentPage = 1;
        renderJobs();
        renderPagination();
      }
      
      // Render jobs for current page
      function renderJobs() {
        jobsContainer.innerHTML = '';
        
        if (filteredJobs.length === 0) {
          jobsContainer.innerHTML = `
            <div class="no-jobs">
              <i class="fas fa-search"></i>
              <p>No jobs found matching your criteria</p>
            </div>
          `;
          paginationContainer.innerHTML = '';
          return;
        }
        
        // Calculate pagination
        const startIndex = (currentPage - 1) * jobsPerPage;
        const endIndex = Math.min(startIndex + jobsPerPage, filteredJobs.length);
        const jobsToRender = filteredJobs.slice(startIndex, endIndex);
        
        jobsToRender.forEach(job => {
          const jobCard = document.createElement('div');
          jobCard.className = 'job-card';
          
          const postedDate = new Date(job.posted);
          const timeAgo = getTimeAgo(postedDate);
          
          let statusClass = '';
          let statusText = '';
          
          switch(job.status) {
            case 'accepted':
              statusClass = 'status-accepted';
              statusText = 'In Progress';
              break;
            case 'done':
              statusClass = 'status-done';
              statusText = 'Completed';
              break;
            case 'cancelled':
              statusClass = 'status-cancelled';
              statusText = 'Cancelled';
              break;
          }
          
          jobCard.innerHTML = `
            <div class="job-card-header">
              <h3 class="job-title">${job.title}</h3>
              <div class="job-status ${statusClass}">${statusText}</div>
            </div>
            
            <div class="job-details">
              <div class="job-detail">
                <i class="fas fa-map-marker-alt"></i>
                <span>${job.location}</span>
              </div>
              <div class="job-detail">
                <i class="fas fa-wallet"></i>
                <span>₹${job.pay}</span>
              </div>
              <div class="job-detail">
                <i class="fas fa-user"></i>
                <span>${job.client}</span>
              </div>
              ${job.duration ? `
                <div class="job-detail">
                  <i class="fas fa-clock"></i>
                  <span>${job.duration}</span>
                </div>
              ` : ''}
            </div>
            
            <p class="job-description">${job.description}</p>
            
            ${job.tags ? `
              <div class="job-tags">
                ${job.tags.map(tag => `<span class="job-tag">${tag}</span>`).join('')}
              </div>
            ` : ''}
            
            <div class="job-card-footer">
              <div class="job-date">${job.status === 'done' ? 'Completed' : 'Posted'} ${timeAgo}</div>
              <div class="actions">
                <button class="btn" style="background: var(--brand-600);" onclick="viewJobDetails(${job.id})">
                  <i class="fas fa-eye"></i> Details
                </button>
                ${job.status === 'accepted' ? `
                  <button class="btn done" onclick="openDoneModal(${job.id})">
                    <i class="fas fa-check"></i> Mark Done
                  </button>
                ` : ''}
                ${job.status === 'done' && !job.rating ? `
                  <button class="btn" style="background: var(--brand-warning);" onclick="openRatingModal(${job.id})">
                    <i class="fas fa-star"></i> Rate
                  </button>
                ` : ''}
              </div>
            </div>
          `;
          
          jobsContainer.appendChild(jobCard);
        });
      }
      
      // Render pagination controls
      function renderPagination() {
        const totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
        
        if (totalPages <= 1) {
          paginationContainer.innerHTML = '';
          return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        if (currentPage > 1) {
          paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})"><i class="fas fa-chevron-left"></i></button>`;
        }
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          if (i === currentPage) {
            paginationHTML += `<button class="pagination-btn active">${i}</button>`;
          } else {
            paginationHTML += `<button class="pagination-btn" onclick="changePage(${i})">${i}</button>`;
          }
        }
        
        // Next button
        if (currentPage < totalPages) {
          paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})"><i class="fas fa-chevron-right"></i></button>`;
        }
        
        paginationContainer.innerHTML = paginationHTML;
      }
      
      // Change page
      window.changePage = function(page) {
        currentPage = page;
        renderJobs();
        renderPagination();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      
      // Open done modal
      window.openDoneModal = function(jobId) {
        selectedJob = jobs.find(j => j.id === jobId);
        
        const modalMessage = document.getElementById('modalMessage');
        const modalJobDetails = document.getElementById('modalJobDetails');
        
        modalMessage.textContent = `Are you sure you want to mark "${selectedJob.title}" as complete?`;
        
        modalJobDetails.innerHTML = `
          <div class="modal-job-detail">
            <span class="label">Client:</span>
            <span class="value">${selectedJob.client}</span>
          </div>
          <div class="modal-job-detail">
            <span class="label">Location:</span>
            <span class="value">${selectedJob.location}</span>
          </div>
          <div class="modal-job-detail">
            <span class="label">Pay:</span>
            <span class="value">₹${selectedJob.pay}</span>
          </div>
        `;
        
        doneModal.style.display = 'flex';
      };
      
      // Close done modal
      function closeDoneModal() {
        doneModal.style.display = 'none';
        selectedJob = null;
      }
      
      // Confirm job done
      function confirmDone() {
        if (selectedJob) {
          selectedJob.status = 'done';
          selectedJob.completed = new Date().toISOString();
          
          // Add to earnings
          const currentEarnings = parseInt(sessionStorage.getItem("walletBalance") || "5000");
          sessionStorage.setItem("walletBalance", currentEarnings + selectedJob.pay);
          
          addNotification(`✅ Completed job: ${selectedJob.title} and earned ₹${selectedJob.pay}`, "success");
          sessionStorage.setItem("jobs", JSON.stringify(jobs));
          
          updateStats();
          applyFilters();
        }
        
        closeDoneModal();
      }
      
      // View job details
      window.viewJobDetails = function(jobId) {
        const job = jobs.find(j => j.id === jobId);
        const detailTitle = document.getElementById('detailTitle');
        const detailContent = document.getElementById('detailContent');
        
        detailTitle.textContent = job.title;
        
        const postedDate = new Date(job.posted);
        const formattedDate = postedDate.toLocaleDateString('en-IN', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        let completedDate = '';
        if (job.completed) {
          const compDate = new Date(job.completed);
          completedDate = compDate.toLocaleDateString('en-IN', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
        }
        
        detailContent.innerHTML = `
          <div class="modal-job-details">
            <div class="modal-job-detail">
              <span class="label">Client:</span>
              <span class="value">${job.client}</span>
            </div>
            <div class="modal-job-detail">
              <span class="label">Location:</span>
              <span class="value">${job.location}</span>
            </div>
            <div class="modal-job-detail">
              <span class="label">Pay:</span>
              <span class="value">₹${job.pay}</span>
            </div>
            <div class="modal-job-detail">
              <span class="label">Status:</span>
              <span class="value" style="text-transform: capitalize;">${job.status}</span>
            </div>
            <div class="modal-job-detail">
              <span class="label">Posted:</span>
              <span class="value">${formattedDate}</span>
            </div>
            ${job.completed ? `
              <div class="modal-job-detail">
                <span class="label">Completed:</span>
                <span class="value">${completedDate}</span>
              </div>
            ` : ''}
            ${job.duration ? `
              <div class="modal-job-detail">
                <span class="label">Duration:</span>
                <span class="value">${job.duration}</span>
              </div>
            ` : ''}
            ${job.rating ? `
              <div class="modal-job-detail">
                <span class="label">Rating:</span>
                <span class="value">
                  ${'★'.repeat(job.rating)}${'☆'.repeat(5 - job.rating)}
                </span>
              </div>
            ` : ''}
          </div>
          
          <h4>Job Description</h4>
          <p>${job.description}</p>
          
          ${job.timeline ? `
            <h4>Job Timeline</h4>
            <div class="timeline">
              ${job.timeline.map(event => `
                <div class="timeline-item">
                  <div class="timeline-dot">
                    <i class="fas fa-${event.action === 'Accepted' ? 'check' : event.action === 'Started' ? 'play' : event.action === 'Completed' ? 'flag' : 'times'}"></i>
                  </div>
                  <div class="timeline-content">
                    ${event.action}
                    <div class="timeline-date">${new Date(event.date).toLocaleString('en-IN')}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          ` : ''}
        `;
        
        detailModal.style.display = 'flex';
      };
      
      // Close detail modal
      function closeDetailModal() {
        detailModal.style.display = 'none';
      }
      
      // Open rating modal
      window.openRatingModal = function(jobId) {
        selectedJob = jobs.find(j => j.id === jobId);
        currentRating = 0;
        
        const ratingJobDetails = document.getElementById('ratingJobDetails');
        
        ratingJobDetails.innerHTML = `
          <div class="modal-job-detail">
            <span class="label">Job:</span>
            <span class="value">${selectedJob.title}</span>
          </div>
          <div class="modal-job-detail">
            <span class="label">Client:</span>
            <span class="value">${selectedJob.client}</span>
          </div>
        `;
        
        // Reset stars
        document.querySelectorAll('.rating-star').forEach(star => {
          star.classList.remove('active');
        });
        
        document.getElementById('ratingText').textContent = 'Tap a star to rate';
        document.getElementById('submitRating').disabled = true;
        
        ratingModal.style.display = 'flex';
      };
      
      // Close rating modal
      function closeRatingModal() {
        ratingModal.style.display = 'none';
        selectedJob = null;
        currentRating = 0;
      }
      
      // Set rating
      function setRating(rating) {
        currentRating = rating;
        highlightStars(rating);
        
        const ratingText = document.getElementById('ratingText');
        ratingText.textContent = `${rating} star${rating > 1 ? 's' : ''}`;
        
        document.getElementById('submitRating').disabled = false;
      }
      
      // Highlight stars up to the given rating
      function highlightStars(rating) {
        document.querySelectorAll('.rating-star').forEach(star => {
          const starRating = parseInt(star.getAttribute('data-rating'));
          if (starRating <= rating) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });
      }
      
      // Submit rating
      function submitRating() {
        if (selectedJob && currentRating > 0) {
          selectedJob.rating = currentRating;
          sessionStorage.setItem("jobs", JSON.stringify(jobs));
          
          addNotification(`⭐ Rated ${currentRating} stars for job: ${selectedJob.title}`, "success");
          updateStats();
          applyFilters();
        }
        
        closeRatingModal();
      }
      
      // Get time ago string
      function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 1) return 'just now';
        if (diffMins < 60) return `${diffMins} minutes ago`;
        if (diffHours < 24) return `${diffHours} hours ago`;
        if (diffDays === 1) return 'yesterday';
        return `${diffDays} days ago`;
      }
      
      // Notifications persistence
      function addNotification(message, type = 'info') {
        const saved = JSON.parse(sessionStorage.getItem('notifications')) || [];
        saved.unshift({
          message,
          type,
          time: Date.now()
        });
        sessionStorage.setItem('notifications', JSON.stringify(saved));
      }
      
      // Initialize the page
      init();
    });
  </script>
</body>
</html>